#!/bin/bash
# make sure there is no preexisting Docker CID file
rm -f /Users/myessail/broad/ABC-Enhancer-Gene-Prediction/wdl/wdl/cromwell-executions/ABCpipeline/1b4c8fe0-2f86-4005-958c-f7fae2bef239/call-makeCandidateRegions/execution/docker_cid
# run as in the original configuration without --rm flag (will remove later)
docker run \
  --cidfile /Users/myessail/broad/ABC-Enhancer-Gene-Prediction/wdl/wdl/cromwell-executions/ABCpipeline/1b4c8fe0-2f86-4005-958c-f7fae2bef239/call-makeCandidateRegions/execution/docker_cid \
  -i \
   \
  --entrypoint /bin/bash \
  -v /Users/myessail/broad/ABC-Enhancer-Gene-Prediction/wdl/wdl/cromwell-executions/ABCpipeline/1b4c8fe0-2f86-4005-958c-f7fae2bef239/call-makeCandidateRegions:/cromwell-executions/ABCpipeline/1b4c8fe0-2f86-4005-958c-f7fae2bef239/call-makeCandidateRegions:delegated \
  quay.io/nbarkas/abc-general-container@sha256:de4c7c3be44f5a6ff7ca22fd2a2a5e21be612e2a3ef166a2ab69ea4cbc0ed016 /cromwell-executions/ABCpipeline/1b4c8fe0-2f86-4005-958c-f7fae2bef239/call-makeCandidateRegions/execution/script

# get the return code (working even if the container was detached)
rc=$(docker wait `cat /Users/myessail/broad/ABC-Enhancer-Gene-Prediction/wdl/wdl/cromwell-executions/ABCpipeline/1b4c8fe0-2f86-4005-958c-f7fae2bef239/call-makeCandidateRegions/execution/docker_cid`)

# remove the container after waiting
docker rm `cat /Users/myessail/broad/ABC-Enhancer-Gene-Prediction/wdl/wdl/cromwell-executions/ABCpipeline/1b4c8fe0-2f86-4005-958c-f7fae2bef239/call-makeCandidateRegions/execution/docker_cid`

# return exit code
exit $rc
